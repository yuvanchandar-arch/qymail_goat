<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>QYMail</title>

  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: white;
      height: 100vh;
    }

    .center-container {
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 25px;
    }

    .logo {
      font-size: 64px;
      font-weight: 700;
      letter-spacing: 4px;
      background: linear-gradient(90deg, #00f5ff, #00ff9c);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .google-btn {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 26px;
      font-size: 18px;
      border-radius: 30px;
      background: white;
      color: #444;
      cursor: pointer;
      border: none;
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }

    .google-btn img {
      width: 22px;
      height: 22px;
    }

    .top-bar {
      position: absolute;
      top: 20px;
      right: 30px;
    }

    .logout-btn {
      padding: 10px 18px;
      border-radius: 20px;
      border: none;
      background: #ff4d4d;
      color: white;
      cursor: pointer;
    }

    .secure-section {
      margin-top: 30px;
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      width: 320px;
    }

    .secure-section input,
    .secure-section textarea {
      padding: 12px 16px;
      border-radius: 8px;
      border: none;
      width: 100%;
    }

    .secure-btn {
      padding: 14px 28px;
      border-radius: 30px;
      border: none;
      cursor: pointer;
      background: linear-gradient(90deg, #ff8a00, #ffdd00);
    }

    .status {
      font-size: 14px;
      white-space: pre-wrap;
      max-width: 420px;
      background: rgba(0,0,0,0.3);
      padding: 15px;
      border-radius: 10px;
    }

    .decrypt-view {
      display: none;
      background: white;
      color: black;
      padding: 15px;
      border-radius: 10px;
      width: 420px;
    }

    .glass-card {
      backdrop-filter: blur(18px);
      background: rgba(255,255,255,0.08);
      border-radius: 24px;
      padding: 30px;
      box-shadow: 0 0 40px rgba(0,255,200,0.25);
      animation: float 6s ease-in-out infinite;
      max-width: 320px;
    }

    .glass-card h3 {
      margin-top: 0;
      font-weight: 600;
      color: #00ffcc;
    }

    .glass-card p {
      opacity: 0.9;
      font-size: 14px;
      line-height: 1.6;
    }

    @keyframes float {
      0% { transform: translateY(0); }
      50% { transform: translateY(-12px); }
      100% { transform: translateY(0); }
    }

    .scroll-section {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 80px 20px;
    }

    .scroll-card {
      max-width: 800px;
      backdrop-filter: blur(16px);
      background: rgba(255,255,255,0.07);
      border-radius: 30px;
      padding: 40px;
      box-shadow: 0 0 50px rgba(0,255,200,0.2);
      animation: fadeUp 1.5s ease forwards;
    }

    .scroll-card p {
      font-size: 18px;
      line-height: 1.8;
      opacity: 0.95;
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* =========================================================
       UI ENHANCEMENTS (ADD ONLY ‚Äì NOTHING ABOVE TOUCHED)
       ========================================================= */

    /* LEFT SIDE ‚Äì QKD VISUAL PANEL */
    .qkd-side {
      position: fixed;
      left: 30px;
      top: 50%;
      transform: translateY(-50%);
      width: 260px;
      backdrop-filter: blur(16px);
      background: rgba(0,255,255,0.08);
      border-radius: 22px;
      padding: 20px;
      box-shadow: 0 0 40px rgba(0,255,255,0.35);
      pointer-events: none;
    }

    .qkd-title {
      font-weight: 600;
      color: #00f5ff;
      margin-bottom: 14px;
      text-align: center;
    }

    .qkd-diagram {
      position: relative;
      height: 160px;
    }

    .qkd-node {
      position: absolute;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }

    .alice {
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      background: linear-gradient(135deg,#00f5ff,#00ff9c);
    }

    .bob {
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      background: linear-gradient(135deg,#7f5cff,#00ffcc);
    }

    .eve {
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      background: #ff4d4d;
      opacity: 0;
      animation: eveBlink 5s infinite;
    }

    .qkd-channel {
      position: absolute;
      top: 50%;
      left: 48px;
      right: 48px;
      height: 2px;
      background: linear-gradient(90deg,#00f5ff,#00ff9c,#7f5cff);
      overflow: hidden;
    }

    .photon {
      width: 10px;
      height: 10px;
      background: white;
      border-radius: 50%;
      position: absolute;
      top: -4px;
      animation: photonMove 2s linear infinite;
    }

    @keyframes photonMove {
      from { left: -15px; }
      to { left: 100%; }
    }

    @keyframes eveBlink {
      0%,70% { opacity: 0; }
      80%,100% { opacity: 1; }
    }

    /* RIGHT SIDE ‚Äì FEATURE PANEL */
    .feature-side {
      position: fixed;
      right: 30px;
      top: 50%;
      transform: translateY(-50%);
      width: 260px;
      backdrop-filter: blur(16px);
      background: rgba(180,0,255,0.1);
      border-radius: 22px;
      padding: 22px;
      box-shadow: 0 0 40px rgba(180,0,255,0.35);
      pointer-events: none;
    }

    .feature-side h4 {
      color: #c77dff;
      margin: 0 0 12px 0;
      text-align: center;
    }

    .feature-side p {
      font-size: 14px;
      opacity: 0.9;
      margin: 8px 0;
    }

    /* LOGO ABOVE PARAGRAPH */
    .qymail-logo {
      position: relative;
      margin-bottom: 30px;
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: linear-gradient(135deg,#00f5ff,#7f5cff,#00ff9c);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 56px;
      font-weight: bold;
      color: white;
      box-shadow: 0 0 60px rgba(0,255,255,0.6);
      animation: logoPulse 4s infinite;
    }


    @keyframes logoPulse {
      0% { box-shadow: 0 0 25px rgba(0,255,255,0.4); }
      50% { box-shadow: 0 0 90px rgba(127,92,255,0.8); }
      100% { box-shadow: 0 0 25px rgba(0,255,255,0.4); }
    }
  </style>
</head>

<body>

<div class="top-bar">
  <button id="logoutBtn" class="logout-btn" style="display:none;">Logout</button>
</div>

<div class="center-container">
  <div class="logo">QYMAIL</div>

  <button id="loginBtn" class="google-btn">
    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" />
    Login with Google
  </button>

  <div id="secureSection" class="secure-section">
    <input id="receiverEmail" type="email" placeholder="Receiver email" />
    <textarea id="message" placeholder="Type your secure email here..."></textarea>
    <input id="attachments" type="file" accept="application/pdf" multiple />
    <button id="secureBtn" class="secure-btn">Send Quantum-Secure Mail</button>
  </div>

  <div id="decryptSection" class="secure-section">
    <input id="sessionIdInput" placeholder="Session ID (QY-xxxx)" />
    <input id="ivInput" placeholder="IV (hex)" />
    <input id="cipherInput" placeholder="Ciphertext (hex)" />
    <button id="decryptBtn" class="secure-btn">üîì Decrypt Secure Mail</button>
  </div>

  <div id="decryptView" class="decrypt-view"></div>
  <div id="status" class="status"></div>

  <div class="glass-card">
    <h3>Quantum-Secure Email</h3>
    <p>‚Ä¢ Quantum Key Distribution</p>
    <p>‚Ä¢ Read-Once Decryption</p>
    <p>‚Ä¢ Encrypted Attachments</p>
    <p>‚Ä¢ Zero-Trust Architecture</p>
  </div>
</div>

<div class="scroll-section" style="position:relative;">
  <div class="qymail-logo">Q</div>
  <div class="scroll-card">
    <p>
      QYMail is a next-generation secure email platform designed for the post-quantum era.
      Every message is protected using keys derived from Quantum Key Distribution.
      Attachments are encrypted, messages are readable only once, and trust is enforced by design.
      This is not just email ‚Äî this is verifiable privacy.
    </p>
  </div>
</div>

<!-- ADD-ONLY SIDE PANELS -->
<div class="qkd-side">
  <div class="qkd-title">Quantum Key Generation</div>
  <div class="qkd-diagram">
    <div class="qkd-node alice">Sender</div>
    <div class="qkd-node bob">Receiver</div>
    <div class="qkd-node eve">Attacker</div>
    <div class="qkd-channel">
      <div class="photon"></div>
    </div>
  </div>
  <p style="font-size:13px;margin-top:12px;">
    Any interception alters quantum states and is instantly detected.
  </p>
</div>

<div class="feature-side">
  <h4>Why Quantum Keys</h4>
  <p>‚öõÔ∏è Physics-based security</p>
  <p>üöÄ No key reuse</p>
  <p>üîê Eavesdropping is detectable</p>
  <p>üìÑ Man-in-the-middle resistant</p>
  <p>üîë True randomness</p>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import {
    getAuth,
    signInWithPopup,
    GoogleAuthProvider,
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCNLBUDQJiwkCg_62UTjSyYAi3nLYlXQzQ",
    authDomain: "qymail.firebaseapp.com",
    projectId: "qymail"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const secureBtn = document.getElementById("secureBtn");
  const decryptBtn = document.getElementById("decryptBtn");
  const status = document.getElementById("status");
  const secureSection = document.getElementById("secureSection");
  const decryptSection = document.getElementById("decryptSection");
  const decryptView = document.getElementById("decryptView");

  const glassCard = document.querySelector(".glass-card");


  loginBtn.onclick = async () => {
    await signInWithPopup(auth, provider);
  };

  logoutBtn.onclick = async () => {
    await signOut(auth);
    location.reload();
  };

  onAuthStateChanged(auth, (user) => {
    if (user) {
      loginBtn.style.display = "none";
      logoutBtn.style.display = "block";
      secureSection.style.display = "flex";
      decryptSection.style.display = "flex";

      if (glassCard) glassCard.style.display = "none";
    }
  });

  secureBtn.onclick = async () => {
    const receiver = receiverEmail.value.trim();
    const message = document.getElementById("message").value.trim();
    const files = document.getElementById("attachments").files;

    if (!receiver || !message) {
      status.innerText = "‚ùå Receiver email and message are required";
      return;
    }

    const attachments = [];

    for (const file of files) {
      if (file.type !== "application/pdf") {
        status.innerText = "‚ùå Only PDF files allowed";
        return;
      }
      if (file.size > 5 * 1024 * 1024) {
        status.innerText = "‚ùå PDF must be ‚â§ 5 MB";
        return;
      }

      const base64 = await new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(",")[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });

      attachments.push({
        name: file.name,
        type: file.type,
        data: base64
      });
    }

    const token = await auth.currentUser.getIdToken(true);

    const res = await fetch(
      "http://127.0.0.1:5001/qymail/us-central1/requestSecureSession",
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({ receiver, message, attachments })
      }
    );

    status.innerText = JSON.stringify(await res.json(), null, 2);
  };

  decryptBtn.onclick = async () => {
    const token = await auth.currentUser.getIdToken(true);

    const res = await fetch(
      "http://127.0.0.1:5001/qymail/us-central1/decryptSecureEmail",
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({
          sessionId: sessionIdInput.value,
          iv: ivInput.value,
          ciphertext: cipherInput.value
        })
      }
    );

    const data = await res.json();

    if (data.plaintext) {
      decryptView.style.display = "block";
      decryptView.innerHTML = `<pre>${data.plaintext}</pre>`;
    }

    if (Array.isArray(data.attachments)) {
      for (const file of data.attachments) {
        const byteChars = atob(file.data);
        const byteNumbers = new Array(byteChars.length);
        for (let i = 0; i < byteChars.length; i++) {
          byteNumbers[i] = byteChars.charCodeAt(i);
        }

        const blob = new Blob([new Uint8Array(byteNumbers)], { type: file.type });
        const url = URL.createObjectURL(blob);

        const btn = document.createElement("button");
        btn.className = "download-btn";
        btn.innerText = `‚¨á Download ${file.name}`;
        btn.onclick = () => {
          const a = document.createElement("a");
          a.href = url;
          a.download = file.name;
          a.click();
          URL.revokeObjectURL(url);
        };

        decryptView.appendChild(btn);
      }
    }
  };
</script>

</body>
</html>
